# 股票量化交易系统 - 服务器部署指南

## 快速部署步骤

### 1. 克隆项目代码

在服务器上克隆项目代码：

```bash
git clone <项目仓库地址> stock_app
cd stock_app
```

### 2. 准备环境

确保服务器已安装Python 3.7或更高版本：

```bash
python3 --version
```

### 3. 设置脚本执行权限

给启动和停止脚本添加执行权限：

```bash
chmod +x start.sh stop.sh
```

### 4. 启动应用

运行启动脚本：

```bash
./start.sh
```

启动脚本会自动执行以下操作：
- 创建并激活虚拟环境
- 升级pip
- 安装所有项目依赖
- 检查并创建必要的配置文件
- 在后台启动Streamlit应用
- 将输出重定向到日志文件

### 5. 查看应用状态

启动后，可以使用以下命令查看实时日志：

```bash
tail -f stock_app.log
```

### 6. 访问应用

应用启动成功后，可以通过以下地址访问：

```
http://服务器IP:8502
```

## 停止应用

要停止运行中的应用，执行：

```bash
./stop.sh
```

## 日志管理

- 所有应用输出都保存在 `stock_app.log` 文件中
- 每次启动会自动清除旧日志
- 使用 `tail -f stock_app.log` 可以实时监控应用状态

## 配置说明

### 默认端口

应用默认使用端口8502。如需修改，请编辑 `start.sh` 文件中的 `PORT` 变量。

### 数据库配置

确保在 `.env` 文件中正确配置数据库连接信息：

```
DB_USER=postgres
DB_PASS=password
DB_HOST=localhost
DB_PORT=5432
DB_NAME=stock
```

如果 `.env` 文件不存在，启动脚本会自动创建一个默认配置。

## 常见问题

### 1. 端口被占用

如果端口8502已被占用，可以在 `start.sh` 中修改 `PORT` 变量为其他未使用的端口。

### 2. 依赖安装失败

如果依赖安装失败，请检查服务器的网络连接和Python版本。对于某些特殊依赖，可能需要额外的系统库。

### 3. 数据库连接错误

确保PostgreSQL数据库服务正在运行，且 `.env` 文件中的配置信息正确。

## 其他提示

- 建议在生产环境中使用进程管理器（如PM2、Supervisor）来管理应用，以确保应用在意外终止后能自动重启
- 对于长期运行的服务，建议设置定期日志轮转，避免日志文件过大