# 买卖点分析 - 预热天数优化说明

## 更新内容

已将预热天数从 **60天** 优化为 **120天**，以确保所有技术指标充分稳定，提供更准确的分析结果。

## 为什么需要预热天数？

预热天数（Warmup Days）是指在开始分析之前，需要积累的历史数据天数。这些数据用于：
1. 计算技术指标（如MACD、RSI、均线）
2. 建立历史参考（如前期高低点）
3. 识别趋势和背离

## 各指标所需数据量分析

| 指标类型 | 计算周期 | 稳定所需天数 | 说明 |
|---------|---------|-------------|------|
| **MACD** | (12, 26, 9) | 35天 | 需要26天EMA + 9天信号线 |
| **RSI** | 14 | 28天 | 14天计算 + 14天稳定期 |
| **MA5/10/20** | 5/10/20 | 20天 | 最长周期MA20 |
| **MA60** | 60 | 60天 | 关键长期均线 |
| **成交量均线** | 5/10 | 10天 | VOL_MA10 |
| **前期高低点** | 回看20天 | +20天 | 用于关键区域识别 |
| **RSI背离检测** | 回看10天 | +10天 | 用于风险过滤 |

## 预热天数计算

### 最小需求（120天）

```
MA60(60天)              60天
+ 前期高低点(20天)      +20天
+ RSI背离检测(10天)     +10天
+ 额外缓冲(30天)        +30天
────────────────────────────
= 总计                  120天
```

### 为什么选择120天？

1. **指标稳定性**
   - MA60需要完整的60天数据
   - 前后各增加30天缓冲，确保边缘数据也有足够的历史参考

2. **分析准确性**
   - 前期高低点需要回看20天
   - RSI背离检测需要回看10天
   - 额外缓冲确保这些分析都有充足的数据支撑

3. **实战经验**
   - 60天太短，指标容易受短期波动影响
   - 120天约半年交易日，能覆盖1-2个完整的趋势周期
   - 既不会太短导致不稳定，也不会太长导致可分析数据太少

## 不同数据量的分析效果

| 总数据量 | 预热天数 | 可分析天数 | 分析效果 |
|---------|---------|-----------|---------|
| 120天 | 120天 | 0天 | ❌ 无法分析 |
| 150天 | 120天 | 30天 | ⚠️ 可分析但数据少 |
| 200天 | 120天 | 80天 | ✅ 良好（约3个月） |
| 250天 | 120天 | 130天 | ✅ 理想（约5个月） |
| 300天 | 120天 | 180天 | ✅ 优秀（约7个月） |

## 推荐配置

### 日线分析
- **最小数据量**：120天（刚好满足预热）
- **建议数据量**：200天以上（约9个月）
- **理想数据量**：250-300天（约11-13个月）

### 周线分析
- **最小数据量**：120周（约2.3年）
- **建议数据量**：150周以上（约3年）
- **理想数据量**：200周（约4年）

### 月线分析
- **最小数据量**：120月（10年）
- **建议数据量**：150月以上（12.5年）
- **理想数据量**：200月（16.7年）

## 新功能说明

### 1. 自动预热天数计算

```python
# 默认使用120天
analyzer = TradingSignalAnalyzer(df)
signals, stats = analyzer.analyze()  # 自动使用120天预热

# 自定义预热天数
signals, stats = analyzer.analyze(min_warmup_days=90)  # 使用90天预热
```

### 2. 数据充足性检查

系统会自动检查数据量：

**数据不足（<120天）：**
```
⚠️ 数据不足，无法进行买卖点分析

- 当前数据：85 个周期
- 最少需要：120 个周期
- 还需要：35 个周期

原因说明：
- MA60均线需要60天数据
- 前期高低点分析需要回看20天
- RSI背离检测需要回看10天
- 额外缓冲确保指标稳定：30天

建议：
- 等待更多交易日数据积累
- 或切换到周线/月线周期
```

**数据充足但不多（120-200天）：**
```
ℹ️ 当前数据量：150 个周期

建议数据量：200个周期以上（约9个月）可以获得更准确的分析结果。
当前可以分析，但历史数据越多，趋势判断越准确。
```

### 3. 分析范围显示

在UI顶部会显示：
```
📅 数据范围：共250个周期，使用前120天作为指标预热，
实际分析130天（2023-05-01 至 2023-09-07）
```

## 对比：60天 vs 120天

| 方面 | 60天预热 | 120天预热 |
|-----|---------|-----------|
| **指标稳定性** | ⚠️ 勉强够用 | ✅ 充分稳定 |
| **MA60可靠性** | ⚠️ 刚好计算 | ✅ 有缓冲数据 |
| **前期高低点** | ❌ 可能不准 | ✅ 有足够历史 |
| **RSI背离** | ❌ 数据不足 | ✅ 可靠检测 |
| **可分析天数** | 多40天 | 少40天 |
| **分析准确度** | ⚠️ 一般 | ✅ 高 |

**结论**：虽然60天能分析更多天数，但120天的分析质量更高，值得牺牲这40天。

## 实际应用建议

### 新股票（数据少）
如果股票上市不久，数据不足120天：
1. 等待数据积累到120天以上
2. 或使用其他策略（如纯形态识别）
3. 或降低要求使用90天预热（accuracy会降低）

### 成熟股票（数据多）
建议保持默认120天预热：
1. 数据充足时自动使用最佳配置
2. 确保分析质量
3. 可以分析更长的历史周期

### 跨周期分析
- **日线**：适合短期（1-2个月）操作
- **周线**：适合中期（3-6个月）操作
- **月线**：适合长期（1年以上）投资

不同周期的信号可以相互验证，增加可靠性。

## 技术实现细节

### analyze()方法参数

```python
def analyze(self, min_warmup_days: int = None) -> Tuple[List[Dict], Dict]:
    """
    Args:
        min_warmup_days: 最小预热天数
                        - None: 自动使用120天
                        - 自定义: 使用指定天数（最小建议60天）

    Returns:
        signals: 交易信号列表
        stats: 统计信息（包含warmup_days字段）
    """
```

### 统计信息增强

stats字典新增字段：
```python
{
    ...
    'warmup_days': 120,  # 使用的预热天数
    ...
}
```

## 常见问题

### Q1: 为什么不能设置更短的预热天数？

**A:** 可以，但不推荐：
- 最小可设置为60天（勉强满足MA60）
- 但前期高低点、RSI背离等功能会不准确
- 信号质量会下降

### Q2: 预热天数越长越好吗？

**A:** 不一定：
- 预热天数越长，指标越稳定
- 但可分析的天数会减少
- 120天是经过权衡的最佳值
- 如果数据非常多（>500天），可以考虑150天

### Q3: 不同周期应该用多少预热天数？

**A:** 建议保持相同的**周期数**：
- 日线：120个交易日
- 周线：120周（约2.3年）
- 月线：120月（10年）

这样可以确保各周期的分析质量一致。

## 更新日期

2026-01-12

## 版本

v1.1 - 预热天数优化
