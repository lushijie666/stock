# 回测分析重构方案

## 改进目标

1. **更清晰的指标分组**：按重要性分为核心指标、交易指标、风险指标三个区域
2. **突出关键指标**：胜率、盈亏比、总收益率等核心指标
3. **新增策略**：RSI、布林带、KDJ等知名策略
4. **改进UI布局**：更好的视觉层次和信息架构

## 新增策略说明

### 1. RSI策略（相对强弱指标）
- **原理**：衡量价格变动的速度和幅度
- **买入信号**：RSI < 30（超卖）且开始上升
- **卖出信号**：RSI > 70（超买）且开始下降
- **参数**：
  - period: 周期（默认14）
  - oversold: 超卖线（默认30）
  - overbought: 超买线（默认70）

### 2. 布林带策略（Bollinger Bands）
- **原理**：基于统计学标准差的通道指标
- **买入信号**：价格触及下轨后反弹
- **卖出信号**：价格触及上轨后回落
- **参数**：
  - period: 周期（默认20）
  - std_dev: 标准差倍数（默认2.0）

### 3. KDJ策略（随机指标）
- **原理**：比较收盘价与最高最低价区间的相对位置
- **买入信号**：K线上穿D线（金叉）且在超卖区
- **卖出信号**：K线下穿D线（死叉）且在超买区
- **参数**：
  - n: RSV周期（默认9）
  - m1: K线平滑（默认3）
  - m2: D线平滑（默认3）

## 新增指标说明

### 核心收益指标
- **初始资金**：回测起始资金
- **最终价值**：包含持仓的总资产
- **总收益率**：(最终价值 - 初始资金) / 初始资金

### 交易质量指标
- **胜率**：盈利交易次数 / 总交易次数 × 100%
- **盈亏比**：平均盈利幅度 / 平均亏损幅度
- **总交易次数**：完成的买卖对数
- **盈利交易**：盈利的交易次数
- **亏损交易**：亏损的交易次数
- **最大连胜**：最多连续盈利次数
- **最大连亏**：最多连续亏损次数

### 风险指标
- **夏普比率**：(策略收益 - 无风险收益) / 收益波动率
- **年化波动率**：收益率的标准差年化值
- **最大回撤**：从最高点到最低点的最大跌幅

## UI布局改进

### 第一部分：交易建议
- 醒目展示当前交易建议

### 第二部分：核心指标（一行3个卡片）
- 初始资金
- 最终价值
- 总收益率

### 第三部分：交易质量（一行4个卡片）
- 胜率
- 盈亏比
- 总交易次数
- 平均持股天数

### 第四部分：风险指标（一行3个卡片）
- 夏普比率
- 年化波动率
- 最大回撤

### 第五部分：图表展示
- 收益对比图
- 交易点位图
- 资金分布图

### 第六部分：交易明细表

## 实施步骤

1. ✅ 添加新策略类型枚举
2. ✅ 实现RSI策略计算
3. ✅ 实现布林带策略计算
4. ✅ 实现KDJ策略计算
5. ✅ 增强指标计算函数（胜率、盈亏比等）
6. ⏳ 更新UI页面展示
7. ⏳ 测试新功能
