# 蜡烛图形态策略设计文档

## 📊 蜡烛图形态分析简介

蜡烛图（K线图）形态分析源于18世纪日本米市交易，是技术分析中最古老、最有效的方法之一。通过识别特定的K线形态，可以预测价格的反转或延续。

---

## 🎯 实现的形态类型

### 1. 单K线反转形态

#### 1.1 锤子线（Hammer）
**特征**：
- 下影线长度 >= 实体的2倍
- 上影线很短或没有
- 出现在下跌趋势中
- 颜色不重要

**信号**：看涨反转

**计算方法**：
```
实体 = |收盘 - 开盘|
下影线 = min(开盘, 收盘) - 最低
上影线 = 最高 - max(开盘, 收盘)

条件：
下影线 >= 实体 * 2
上影线 <= 实体 * 0.1
```

#### 1.2 倒锤子线（Inverted Hammer）
**特征**：
- 上影线长度 >= 实体的2倍
- 下影线很短或没有
- 出现在下跌趋势中

**信号**：看涨反转

#### 1.3 上吊线（Hanging Man）
**特征**：
- 与锤子线形态相同
- 出现在上涨趋势中

**信号**：看跌反转

#### 1.4 流星线（Shooting Star）
**特征**：
- 与倒锤子线形态相同
- 出现在上涨趋势中

**信号**：看跌反转

#### 1.5 十字星（Doji）
**特征**：
- 开盘价 ≈ 收盘价（实体很小）
- 上下影线长度不限

**信号**：趋势不确定，可能反转

**类型**：
- 普通十字星：上下影线相当
- 长腿十字星：上下影线都很长
- 蜻蜓十字星：只有下影线
- 墓碑十字星：只有上影线

---

### 2. 双K线组合形态

#### 2.1 看涨吞没（Bullish Engulfing）
**特征**：
- 第一根：阴线（下跌）
- 第二根：阳线（上涨）
- 第二根完全吞没第一根（开盘<第一根收盘，收盘>第一根开盘）
- 出现在下跌趋势中

**信号**：强烈看涨反转

#### 2.2 看跌吞没（Bearish Engulfing）
**特征**：
- 第一根：阳线
- 第二根：阴线
- 第二根完全吞没第一根
- 出现在上涨趋势中

**信号**：强烈看跌反转

#### 2.3 乌云盖顶（Dark Cloud Cover）
**特征**：
- 第一根：大阳线
- 第二根：阴线，开盘高于第一根最高，收盘在第一根实体中部以下
- 出现在上涨趋势中

**信号**：看跌反转

#### 2.4 刺透形态（Piercing Pattern）
**特征**：
- 第一根：大阴线
- 第二根：阳线，开盘低于第一根最低，收盘在第一根实体中部以上
- 出现在下跌趋势中

**信号**：看涨反转

---

### 3. 三K线组合形态

#### 3.1 晨星（Morning Star）
**特征**：
- 第一根：大阴线
- 第二根：小实体（颜色不限），与第一根有跳空缺口
- 第三根：大阳线，收盘价进入第一根实体中部以上
- 出现在下跌趋势中

**信号**：强烈看涨反转

#### 3.2 黄昏星（Evening Star）
**特征**：
- 第一根：大阳线
- 第二根：小实体，与第一根有跳空缺口
- 第三根：大阴线，收盘价进入第一根实体中部以下
- 出现在上涨趋势中

**信号**：强烈看跌反转

#### 3.3 三只白兵（Three White Soldiers）
**特征**：
- 连续三根阳线
- 每根收盘价都高于前一根
- 开盘价在前一根实体内
- 影线较短
- 出现在下跌趋势或盘整后

**信号**：强烈看涨延续

#### 3.4 三只乌鸦（Three Black Crows）
**特征**：
- 连续三根阴线
- 每根收盘价都低于前一根
- 开盘价在前一根实体内
- 影线较短
- 出现在上涨趋势或盘整后

**信号**：强烈看跌延续

---

## 🔧 技术实现要点

### 1. 趋势判断

使用移动平均线判断当前趋势：
- 上涨趋势：价格 > MA(20)
- 下跌趋势：价格 < MA(20)
- 盘整：价格在MA附近波动

### 2. 实体和影线计算

```python
def analyze_candle(row):
    open_price = row['opening']
    close_price = row['closing']
    high_price = row['highest']
    low_price = row['lowest']

    # 实体
    body = abs(close_price - open_price)

    # 影线
    upper_shadow = high_price - max(open_price, close_price)
    lower_shadow = min(open_price, close_price) - low_price

    # 颜色
    is_bullish = close_price > open_price

    return body, upper_shadow, lower_shadow, is_bullish
```

### 3. 形态强度评分

不同形态给予不同的强度评分：
- 单K线形态：弱（1-2分）
- 双K线形态：中（3-4分）
- 三K线形态：强（5分）

### 4. 组合判断

可以结合多个形态：
- 多个看涨形态叠加 → 强烈买入信号
- 看涨形态 + 超卖指标 → 更可靠的买入信号

---

## 📊 策略参数

```python
CANDLESTICK_PARAMS = {
    'body_min_ratio': 0.6,          # 实体最小比例（相对总长度）
    'shadow_min_ratio': 2.0,        # 影线最小比例（相对实体）
    'shadow_max_ratio': 0.1,        # 影线最大比例（相对实体）
    'doji_body_ratio': 0.1,         # 十字星实体比例阈值
    'engulf_body_ratio': 1.2,       # 吞没形态实体比例
    'trend_ma_period': 20,          # 趋势判断MA周期
    'min_body_size': 0.01,          # 最小实体大小（避免噪音）
}
```

---

## 🎯 实现优先级

### 第一阶段：基础单K线形态
1. 锤子线 / 上吊线
2. 倒锤子线 / 流星线
3. 十字星

### 第二阶段：经典双K线形态
1. 看涨吞没 / 看跌吞没
2. 乌云盖顶 / 刺透形态

### 第三阶段：强势三K线形态
1. 晨星 / 黄昏星
2. 三只白兵 / 三只乌鸦

---

## 💡 使用建议

### 1. 组合使用
- 蜡烛图形态 + 支撑/阻力位
- 蜡烛图形态 + 成交量确认
- 蜡烛图形态 + RSI/MACD等指标

### 2. 风险控制
- 设置止损位（形态最低/最高点）
- 等待确认（下一根K线确认）
- 注意假信号（盘整期形态可靠性低）

### 3. 时间周期
- 日线：最可靠
- 周线：信号更强，但较少
- 分钟线：信号多但噪音大

---

## 📈 预期效果

- **识别准确率**：70-80%（需要结合趋势和成交量）
- **信号频率**：每月5-15个信号（日线数据）
- **适用场景**：趋势明确时效果最佳

---

## 🔍 质量保证

### 1. 回测验证
- 使用历史数据验证每种形态的胜率
- 统计不同市场环境下的表现

### 2. 参数优化
- 可调整实体/影线比例阈值
- 可调整趋势判断参数

### 3. 可视化展示
- 在K线图上标注识别的形态
- 显示形态名称和预期方向

---

## 📚 参考资料

1. **《日本蜡烛图技术》** - Steve Nison
2. **《蜡烛图方法：从入门到精通》** - Stephen Bigalow
3. **经典形态胜率统计研究**
4. **实战案例分析**

---

## ✅ 总结

蜡烛图形态策略将提供：
- ✅ 15+种经典K线形态识别
- ✅ 自动趋势判断
- ✅ 信号强度评分
- ✅ 可视化标注
- ✅ 与现有策略组合使用

这将大大丰富买卖点决策的维度！
