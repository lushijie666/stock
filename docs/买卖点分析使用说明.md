# 买卖点分析功能使用说明

## 功能概述

买卖点分析功能是一个基于多层级指标体系的交易信号生成系统，帮助您识别高质量的买卖时机。

## 核心策略

> 在 MACD 与 RSI 同向的趋势中，只在关键结构位，出现放量的 K 线反转形态时入场；
> 当 RSI 背离且量能衰减时退出。

## 四层级分析体系

### ① 市场状态判定（MACD + RSI）

**回答的问题：能不能做多/做空/观望？**

#### MACD 判断趋势方向
- **MACD 在 0轴上方** → 只考虑做多
- **MACD 在 0轴下方** → 只考虑做空
- **MACD 贴着 0 轴来回** → 震荡，不交易或降低仓位

#### RSI 判断趋势强度
传统的超买超卖用法（RSI>70卖出，RSI<30买入）在趋势市中会错失大行情。

我们的用法：
- **RSI > 55** → 多头趋势
- **RSI < 45** → 空头趋势
- **45–55** → 震荡

**示例：**
```
MACD = 0.5 (在0轴上方) + RSI = 62 (多头趋势)
→ 市场状态：可以考虑做多
```

---

### ② 关键区域识别（K线形态 + 结构位置）

**回答的问题：在哪里做？**

不是随便看到信号就进场，而是要在"对的地方"。

#### 关键区域包括：
1. **均线支撑/阻力**
   - MA5、MA10、MA20、MA60 附近（±2%）
   - 价格在均线附近时支撑/阻力效果最强

2. **前期高低点**
   - 回看20天的最高点/最低点
   - 这些位置往往有强烈的心理效应

3. **重要K线形态位置**
   - 吞没、启明星/黄昏星、锤子线等重要形态
   - 这些形态本身就是市场情绪的转折点

**示例：**
```
当前价格：10.50
MA20：10.48 (差距0.2%)
前期低点：10.45
→ 判定：在关键支撑区
```

---

### ③ 入场触发验证（K线形态 + 成交量）

**回答的问题：现在是不是那个点？**

#### 两个必要条件：

**1. K线形态匹配方向**
- 做多时：看涨吞没、启明星、锤子线、倒锤子线、刺透形态、三只白兵
- 做空时：看跌吞没、黄昏星、流星线、上吊线、乌云盖顶、三只乌鸦

**2. 成交量放大确认**
成交量不是用来看多空，是用来验证K线是否"有人参与"。

成交量有效的判定：
- 当前成交量 ≥ 5日均量 × 1.3（放大30%以上）

#### 三种有效的放量情况（做多为例）：
1. **吞没 + 放量** → 强势反转
2. **回调缩量，反转放量** → 洗盘结束
3. **突破关键位时明显放量** → 真突破

**示例：**
```
今日形态：看涨吞没
今日成交量：5,200,000股
5日均量：3,800,000股
成交量比：5,200,000 / 3,800,000 = 1.37x
→ 触发条件：✅ 满足（形态匹配 + 成交量放大）
```

---

### ④ 风险过滤（RSI背离 + 成交量）

**回答的问题：这个信号会不会是假突破？**

#### RSI 背离的正确用法

**重要：背离 ≠ 立刻反转**
**背离 = 不要加仓 / 准备离场**

#### 两种背离：

**1. 顶背离（做多风险）**
```
价格：创新高
RSI：不创新高
成交量：走弱
→ 这不是做空信号，而是"平多/减仓信号"
```

**2. 底背离（做空风险）**
```
价格：创新低
RSI：不创新低
成交量：走弱
→ 这不是做多信号，而是"平空/减仓信号"
```

**风险等级：**
- **LOW**：有背离但成交量正常
- **MEDIUM**：背离 + 成交量开始走弱
- **HIGH**：背离 + 成交量明显衰减 → 建议退出

---

## 使用流程

### 1. 进入买卖点分析页面

1. 在股票列表中选择一只股票
2. 点击"图表"按钮打开详情
3. 在顶部选择时间周期（天/周/月/30分钟）
4. 切换到"买卖点分析"标签

### 2. 查看分析结果

#### 顶部统计：
- 总信号数
- 买入信号数
- 卖出信号数
- 强信号数

#### 信号详情：
每个信号展示：
- 📅 日期和价格
- 🎯 信号类型（买入/卖出）
- 💪 信号强度（强/弱）
- 📝 综合判断理由
- 📊 四步分析详情（可展开查看）

#### 逐日分析查询：
- 选择任意日期
- 查看该日完整的4步分析过程
- 即使没有生成信号，也能看到各项指标的状态

### 3. 理解信号动作

信号包含4种动作类型：
- **【开多】ENTER_LONG**：建立多头仓位
- **【平多】EXIT_LONG**：平掉多头仓位
- **【开空】ENTER_SHORT**：建立空头仓位
- **【平空】EXIT_SHORT**：平掉空头仓位

---

## 信号示例解读

### 示例1：强买入信号

```
📅 2024-03-15 - 【开多】价格: ¥52.30
信号类型: 🔴 买入  强度: 💪 强

综合判断：
MACD在0轴上方 | RSI=58.3（多头趋势） |
在关键支撑区：价格触及MA20线(52.15), 接近前期低点(51.80) |
出现🔨 锤子线 | 成交量放大1.5倍

四步分析：
① 市场状态：LONG (置信度75%)
② 关键区域：在支撑区
③ 入场触发：✅ 触发（形态+成交量确认）
④ 风险过滤：✅ 无明显风险
```

**操作建议：可以考虑买入**

---

### 示例2：退出信号

```
📅 2024-04-20 - 【平多】价格: ¥68.50
信号类型: 🟢 卖出  强度: 💪 强

综合判断：
RSI顶背离 + 成交量衰减，建议平多

四步分析：
① 市场状态：LONG (但置信度下降)
② 关键区域：在阻力区
③ 入场触发：❌ 未触发
④ 风险过滤：🔴 高风险
   - 风险类型：BEARISH_DIVERGENCE (顶背离)
   - 建议退出：是
   - 成交量衰减：是
```

**操作建议：应该考虑退出多头仓位**

---

## 注意事项

### 1. 数据要求
- 至少需要60个数据周期才能进行分析
- 不同时间周期（日线/周线/月线）会产生不同的信号

### 2. 信号筛选严格
本系统采用严格的多层级筛选：
- 只在MACD与RSI同向时考虑信号
- 必须有K线形态确认
- 必须有成交量放大确认
- 会过滤掉有背离风险的信号

因此生成的信号数量可能较少，但质量更高。

### 3. 不是机械交易系统
- 信号仅供参考，不构成投资建议
- 需要结合市场环境、个股基本面等综合判断
- 建议使用止损止盈来控制风险

### 4. 适用场景
- ✅ 趋势明确的市场
- ✅ 有一定波动的个股
- ❌ 横盘震荡的市场（会产生很少或没有信号）
- ❌ 停牌、一字板等异常情况

---

## 技术实现

### 核心模块

1. **TradingSignalAnalyzer** (`utils/trading_signal_analyzer.py`)
   - 四层级分析逻辑
   - 信号生成引擎

2. **Trading Analysis UI** (`utils/trading_analysis_ui.py`)
   - 信号展示界面
   - 逐日分析查询

3. **Stock Chart Service** (`service/stock_chart.py`)
   - 页面集成
   - 数据准备

### 依赖的指标

- MACD（12, 26, 9）
- RSI（14周期）
- MA（5, 10, 20, 60）
- 成交量均线（5, 10）
- K线形态识别（26种形态）

---

## 常见问题

### Q1: 为什么我看不到任何信号？

**A:** 可能的原因：
1. 市场处于震荡期（MACD在0轴附近，RSI在45-55之间）
2. 没有出现符合条件的K线形态
3. 成交量不够放大
4. 时间周期内数据不足60个

### Q2: 强信号和弱信号的区别？

**A:** 强信号需要满足：
- 市场方向置信度 > 70%
- 在明确的支撑/阻力区
- 成交量放大 ≥ 1.5倍

弱信号可能只满足部分条件。

### Q3: 如何选择时间周期？

**A:**
- **日线**：适合短线波段操作（1-2周）
- **周线**：适合中线操作（1-3个月）
- **月线**：适合长线投资（半年以上）
- **30分钟**：适合日内交易（需要盯盘）

建议：多周期共振时信号更可靠。

### Q4: 退出信号和入场信号哪个更重要？

**A:** 都很重要，但退出信号（RSI背离+成交量衰减）应该优先考虑：
- 入场可以等待更好的机会
- 但风险来临时应该及时离场
- "保本是第一位的"

---

## 后续优化方向

1. **回测功能**：基于历史信号进行回测，评估策略表现
2. **止损止盈**：自动计算建议的止损止盈位
3. **多股监控**：批量分析多只股票，找出最佳标的
4. **信号提醒**：实时监控，有新信号时发送通知
5. **参数调优**：允许用户自定义MACD、RSI等参数

---

## 版本信息

- 版本：v1.0
- 更新日期：2026-01-12
- 作者：Claude Code

## 参考资料

- 《日本蜡烛图技术》 - Steve Nison
- MACD指标的实战应用
- RSI背离的正确理解
- 成交量分析方法
